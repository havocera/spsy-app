(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-print-print"],{"28f6":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uForm:n("a2b6").default,uFormItem:n("46b4").default,uInput:n("55c0").default,uPicker:n("6bc8").default,uButton:n("231f").default},r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"main"},[n("v-uni-view",{staticClass:"title2"},[e._v("一物一码  便捷打印")]),n("v-uni-view",{staticStyle:{"margin-left":"20upx","margin-right":"20upx"}},[n("u-form",{ref:"uForm",attrs:{model:e.form}},[n("u-form-item",{attrs:{label:"打印样式","label-width":"150"}},[n("u-input",{attrs:{type:e.type,border:e.border},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.styleshow=!0}},model:{value:e.stylename,callback:function(t){e.stylename=t},expression:"stylename"}}),n("u-picker",{attrs:{mode:"selector","default-selector":[0],range:e.stylelist,"range-key":"stylename"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.actionSheetCallback4.apply(void 0,arguments)}},model:{value:e.styleshow,callback:function(t){e.styleshow=t},expression:"styleshow"}})],1),n("u-form-item",{attrs:{label:"选择产品","label-width":"150"}},[n("u-input",{attrs:{type:e.type,border:e.border},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.show=!0}},model:{value:e.cpmc,callback:function(t){e.cpmc=t},expression:"cpmc"}}),n("u-picker",{attrs:{mode:"selector","default-selector":[0],range:e.productList,"range-key":"text"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.actionSheetCallback2.apply(void 0,arguments)}},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}})],1),n("u-form-item",{attrs:{label:"选择批次号","label-width":"150"}},[n("u-input",{attrs:{type:e.type,border:e.border},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.pchshow=!0}},model:{value:e.form.pch,callback:function(t){e.$set(e.form,"pch",t)},expression:"form.pch"}}),n("u-picker",{attrs:{mode:"selector","default-selector":[0],range:e.pchList,"range-key":"text"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.actionSheetCallback3.apply(void 0,arguments)}},model:{value:e.pchshow,callback:function(t){e.pchshow=t},expression:"pchshow"}})],1),n("u-form-item",{attrs:{label:"打印份数","label-width":"150"}},[n("u-input",{attrs:{placeholder:"请输入打印数量",type:"number",border:e.border},model:{value:e.form.num,callback:function(t){e.$set(e.form,"num",t)},expression:"form.num"}})],1)],1),n("u-button",{attrs:{type:"success"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.senBleLabel.apply(void 0,arguments)}}},[e._v("打印")])],1)],1)},o=[]},"3f1b":function(e,t,n){"use strict";var i=n("6d13"),r=n.n(i);r.a},"6d13":function(e,t,n){var i=n("fd56");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var r=n("4f06").default;r("7a12d7a3",i,!0,{sourceMap:!1,shadowMode:!1})},a281:function(e,t,n){"use strict";n.r(t);var i=n("28f6"),r=n("e34d");for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("3f1b");var a,c=n("f0c5"),s=Object(c["a"])(r["default"],i["b"],i["c"],!1,null,"8f9d69f2",null,!1,i["a"],a);t["default"]=s.exports},b3f8:function(e,t,n){"use strict";var i=n("4ea4");n("a630"),n("fb6a"),n("c19f"),n("ace4"),n("d3b7"),n("3ca3"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n("b85c")),o=n("c5e3"),a=n("f4a7"),c=(n("6c24"),{data:function(){return{stylename:"制码打印",styleid:1,currDev:null,show:!1,chandi:!1,pchshow:!1,styleshow:!1,type:"select",devices:[],cpmc:"",stylelist:[{styleid:0,stylename:"食用农产品合格证"},{styleid:1,stylename:"制码打印"}],form:{cdbh:"",cpbh:"",pch:"",num:""},border:!1,productList:[],baselist:[],pchList:[]}},onLoad:function(){this.getbase(),this.currDev=uni.getStorageSync("ble"),this.devices=uni.getStorageSync("dev"),console.log(this.currDev),this.getBLEServices(this.currDev.deviceId)},methods:{onBackPress:function(e){if(console.log(e),"backbutton"===e.from)return 遮罩层是否隐藏||uni.navigateBack(),!0},actionSheetCallback4:function(e){this.stylename=this.stylelist[e].stylename,this.styleid=this.stylelist[e].styleid},actionSheetCallback2:function(e){this.form.cpbh=this.productList[e].value,this.cpmc=this.productList[e].text;var t=uni.getStorageSync("token"),n=this;uni.request({url:o.api_base_url+"/getpchPrint?token="+t,data:{cpbh:n.form.cpbh},success:function(e){console.log(e),n.pchList=e.data.data}})},actionSheetCallback3:function(e){this.form.pch=this.pchList[e].text},getbase:function(){var e=this,t=uni.getStorageSync("token");uni.request({url:o.api_base_url+"/getProductpch?token="+t,success:function(t){console.log(t),e.productList=t.data.data}})},getBLEServices:function(e){var t=this,n=e;console.log("获取蓝牙设备所有服务(service)。---------------"),uni.getBLEDeviceServices({deviceId:n,complete:function(e){console.log(e);uni.hideLoading();for(var i=function(){console.log(e.services[r].uuid);var i=e.services[r].uuid;uni.getBLEDeviceCharacteristics({deviceId:n,serviceId:i,success:function(e){var r=JSON.parse(JSON.stringify(e));console.log("deviceId = ["+n+"]  serviceId = ["+i+"]");for(var o=0;o<r.characteristics.length;o++)if(1==r.characteristics[o].properties.write){var a=r.characteristics[o].uuid;for(var c in console.log(" deviceId = ["+n+"]  serviceId = ["+i+"] characteristics=["+a),t.devices)if(t.devices[c].deviceId==n){t.devices[c].services.push({serviceId:i,characteristicId:a});break}console.log(JSON.stringify(t.devices))}}})},r=0;r<e.services.length;r++)i()},fail:function(e){console.log(e)}})},senBlData:function(e,t,n,i){console.log("************deviceId = ["+e+"]  serviceId = ["+t+"] characteristics=["+n+"]");var r=Array.from(i);function o(e,t){for(var n={},i=0,r=0;r<e.length;r+=t)n[i]=e.slice(r,r+t),i++;return n}var a=o(r,20);function c(i,r){var o=i[r];if("undefined"!=typeof o){console.log("第【"+r+"】次写数据"+o);for(var a=new ArrayBuffer(o.length),s=new DataView(a),l=0;l<o.length;l++)s.setUint8(l,o[l]);uni.writeBLECharacteristicValue({deviceId:e,serviceId:t,characteristicId:n,value:a,success:function(e){console.log(e),c(i,r+1)},fail:function(e){console.log(e),uni.showToast({icon:"none",title:"打印机不支持低功耗蓝牙",duration:1e3})}})}}console.log(a);var s=0;c(a,s)},senBleLabel:function(){for(var e in this.devices)if(this.devices[e].deviceId==this.currDev.deviceId){this.currDev.services=this.devices[e].services;break}console.log(this.currDev.name);var t=this.currDev.deviceId,n="",i="";"BTMU33"==this.currDev.name?(n=this.currDev.services[2].serviceId,i=this.currDev.services[2].characteristicId):(n=this.currDev.services[0].serviceId,i=this.currDev.services[0].characteristicId);var c=a.jpPrinter.createNew(),s=this,l=uni.getStorageSync("token");uni.request({url:o.api_base_url+"/code?token="+l,data:s.form,method:"POST",success:function(e){if(console.log(e),8==e.data.code)uni.showToast({title:"该批次号存在错误",icon:"none",duration:2e3});else{var o,a=(0,r.default)(e.data.data);try{for(a.s();!(o=a.n()).done;){var l=o.value;c.test(l.cpmc,l.cpgg,l.create_date,l.city,l.fzrtel,l.qymc,l.sym,s.styleid)}}catch(d){a.e(d)}finally{a.f()}s.senBlData(t,n,i,c.getData()),uni.showToast({title:"正在打印",duration:2e3})}},fail:function(e){uni.showToast({title:"生产溯源码错误",icon:"none",duration:2e3})}})}}});t.default=c},b85c:function(e,t,n){"use strict";n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=r(n("06c5"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(0,i.default)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n["return"]||n["return"]()}finally{if(s)throw a}}}}},e34d:function(e,t,n){"use strict";n.r(t);var i=n("b3f8"),r=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=r.a},fd56:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.title2[data-v-8f9d69f2]{width:100%;height:%?100?%;text-align:center;font-size:%?30?%;line-height:%?100?%}.pickbt[data-v-8f9d69f2]{display:inline-block;height:%?40?%;line-height:%?40?%;text-align:center;background-color:#fff}.plaClass[data-v-8f9d69f2]{color:#dbdbdb}.container999[data-v-8f9d69f2]{width:100vw;font-size:%?28?%;min-height:100vh;overflow:hidden;color:#6b8082;position:relative}.container999 .title[data-v-8f9d69f2]{height:%?80?%;line-height:%?80?%;padding-left:4%;border-bottom:1px solid #f5f5f5}.container999 .buttonBox[data-v-8f9d69f2]{width:91%;margin:0 auto;height:%?84?%;border-radius:%?84?%;color:#fff;display:flex;align-items:center;justify-content:center;position:fixed;bottom:%?100?%;left:0;right:0;background-color:#10cb84}.container999 .tri[data-v-8f9d69f2]{width:0;height:0;border-left:%?8?% solid transparent;border-right:%?8?% solid transparent;right:%?30?%!important;border-top:%?16?% solid #545151}.container999 .line[data-v-8f9d69f2]{margin-top:%?30?%;height:%?100?%;width:92%;margin:0 auto;border-bottom:1px solid #f5f5f5;display:flex}.container999 .line .lineRight[data-v-8f9d69f2]{flex:1;height:100%;display:flex;align-items:center;justify-content:space-between;position:relative}.container999 .line .lineRight .tips[data-v-8f9d69f2]{color:#9a9a9c;font-weight:700}.container999 .line .lineLeft[data-v-8f9d69f2]{display:flex;width:20%;align-items:center;height:100%;font-weight:700;color:#000}.container999 .line .input[data-v-8f9d69f2]{padding-right:%?20?%;height:100%;width:70%;text-align:left;font-size:%?28?%;color:#545151}.container999 .line .picker[data-v-8f9d69f2]{height:100%;justify-content:flex-start;display:flex;align-content:center;width:%?500?%}.container999 .line uni-picker[data-v-8f9d69f2]{height:%?84?%;line-height:%?84?%}',""]),e.exports=t}}]);